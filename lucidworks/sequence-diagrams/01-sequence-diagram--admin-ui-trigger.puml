@startuml

/' 
ğŸ›  Index Trigger Flow (UI Button)

Scenario:
1. Admin clicks a â€œSync Nowâ€ button in Drupal UI.
2. Drupal re-indexes content using the Search API and builds the exportable data.
3. Drupal triggers a Fusion connector to ingest the content from the JSON endpoint.
4. Fusion fetches the data, starts the indexing job, and populates the Fusion Collection.

Requirements:
â€¢ Use actor for Admin.
â€¢ Use participants for Drupal UI, Drupal Search API, Drupal JSON Export, Fusion Connector, Indexing Pipeline, and Fusion Collection.
â€¢ Use `as` aliases and `<style>` block for consistent formatting.
â€¢ Use activation blocks to show processing time.
â€¢ Use notes to explain logic or highlight custom modules.

Related diagrams:
 - ING-002 | SEQ-003 | Admin Manual Trigger via Drush (02-sequence-diagram--drush-trigger.puml)
 - ING-004 | SEQ-005 | Fusion UI â€œFetch Nowâ€ Trigger (04-sequence-diagram--restv2-fetch-now.puml)
'/

<style>
  title {
    FontSize 30
  }
  box {
    FontSize 25
    .drupalPlatform {
      BackgroundColor #F0F0F0
    }
    .fusionPlatform {
      BackgroundColor #E0F7F7
    }
  }
</style>

title 01 â€“ Admin Manual Trigger via Drupal UI â€“ Lucidworks + Drupal Integration

autonumber

actor "Admin" as Admin

box "Drupal Platform" <<drupalPlatform>>
  participant DrupalUI [
    =ğŸ–±ï¸ Drupal UI
    ----
    ""Sync Now Button (Custom)""
  ]
  participant SearchAPI [
    =ğŸ“¦ Drupal Search API
    ----
    ""Indexer (Custom Module)""
  ]
  participant DrupalExport [
    =ğŸ”„ Drupal JSON Export
    ----
    ""/fusion-export/{$server}/{$index}""
  ]
end box

box "Fusion Platform" <<fusionPlatform>>
  participant FusionConnector [
    =ğŸ”§ Fusion Connector
    ----
    ""REST V2 or Custom""
  ]
  participant IndexingPipeline [
    =ğŸ“Š Fusion Indexing
    ----
    ""Pipeline""
  ]
  database "ğŸ—ƒï¸ Fusion Collection" as FusionCollection
end box

Admin -> DrupalUI: Click **Sync Now** button
note right of DrupalUI: Custom button triggers indexing logic
activate DrupalUI
DrupalUI -> SearchAPI: Trigger internal Drupal re-index
deactivate DrupalUI

activate SearchAPI
note right of SearchAPI: Uses Drupal Search API\nframework to build data export
SearchAPI -> DrupalExport: Generate latest exportable data
deactivate SearchAPI

note over DrupalExport
  Acts as middleware between
  Drupal and Fusion Connector.
  Can be contributed or custom-built.
end note

DrupalUI -> FusionConnector: HTTP request to start ingestion

activate FusionConnector
note right of FusionConnector
  Triggers crawl from JSON endpoint:
  â€¢ Full (REST V2)
  â€¢ *Partial (Custom Connector)
end note
FusionConnector -> DrupalExport: Fetch JSON export
activate DrupalExport
DrupalExport --> FusionConnector: Return content data
deactivate DrupalExport

FusionConnector -> IndexingPipeline: Start indexing job
deactivate FusionConnector

activate IndexingPipeline
IndexingPipeline -> FusionCollection: Ingest into Fusion Collection
deactivate IndexingPipeline

note bottom
  âš ï¸ *For partial updates, Lucidworks will call the JSON Export endpoint
  with a query parameter like **?since=timestamp**
  to limit the crawl to recently updated items.
end note

legend bottom
|= Component             |= Meaning |
| **Drupal Platform**    ||
| ğŸ–±ï¸ Drupal UI           | Sync Now button triggering indexing |
| ğŸ“¦ Drupal Search API   | Custom indexing module |
| ğŸ”„ Drupal JSON Export  | Acts as middleware endpoint |
| **Fusion Platform**    ||
| ğŸ”§ Fusion Connector    | REST V2 or Custom connector to pull data |
| ğŸ“Š Fusion Indexing     | Lucidworks pipeline to transform & ingest |
| ğŸ—ƒï¸ Fusion Collection   | Final Lucidworks index target |
endlegend

@enduml