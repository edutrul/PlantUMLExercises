@startuml

/' 
@id: ING-005
@file: ING-005--custom-auto-webhook.puml
@title: Auto Partial Update via Webhook
@type: sequence
@description: Shows how a content editor submits a form in Drupal, which triggers a webhook to Lucidworks to perform partial indexing.
@related: ING-004, ING-006

ğŸ›  Auto Partial Update via Webhook

Scenario:
1. A content editor submits a press release form in Drupal UI.
2. Drupal triggers a node update event, which the webhook handler listens for.
3. The system reindexes the updated content using the Drupal Search API.
4. Drupal JSON Export prepares the exportable payload.
5. A webhook is sent to Lucidworks with the updated entity ID.
6. Lucidworks fetches the updated data using ?since=timestamp or ?id=
7. Fusion indexing pipeline starts and ingests the partial data into the Fusion Collection.

Requirements:
â€¢ Use actor for Editor.
â€¢ Use participants for Drupal UI, Webhook Handler, Drupal Search API, Drupal JSON Export, Custom Connector, Indexing Pipeline, and Fusion Collection.
â€¢ Highlight Search API as a contrib module.
â€¢ Mention that JSON Export can be custom or contributed.
â€¢ Emphasize that partial indexing requires query param support.
â€¢ Style via `<style>` block for consistency.
'/

<style>
  title {
    FontSize 30
  }
  box {
    FontSize 25
    .drupalPlatform {
      BackgroundColor #F0F0F0
    }
    .fusionPlatform {
      BackgroundColor #E0F7F7
    }
  }
</style>

title Auto Partial Update via Webhook

autonumber

actor Editor

box "Drupal Platform" <<drupalPlatform>>
  participant DrupalUI [
    =ğŸ“ Drupal UI
    ----
    ""Press Release Form""
  ]
  participant WebhookHandler [
    =ğŸ§  Webhook Handler
    ----
    ""Node Updated Trigger""
  ]
  participant SearchAPI [
    =ğŸ“¦ Drupal Search API
    ----
    ""Indexer (Contrib Module)""
  ]
  participant DrupalExport [
    =ğŸ”„ Drupal JSON Export
    ----
    ""/fusion-export/{$server}/{$index}""
  ]
end box

box "Fusion Platform" <<fusionPlatform>>
  participant CustomConnector [
    =ğŸ’¡ Custom Connector
    ----
    ""Webhook Receiver""
  ]
  participant IndexingPipeline [
    =ğŸ“Š Fusion Indexing
    ----
    ""Pipeline""
  ]
  database "ğŸ“‚ Fusion Collection" as FusionCollection
end box

Editor -> DrupalUI: Submit press release form
note right of DrupalUI: Standard Drupal node form
activate DrupalUI
DrupalUI -> WebhookHandler: Trigger node update event
deactivate DrupalUI

activate WebhookHandler
WebhookHandler -> SearchAPI: Trigger re-index for updated content
deactivate WebhookHandler

activate SearchAPI
note over SearchAPI
  Uses Drupal Search API (contrib module)
  to build data export
end note
SearchAPI -> DrupalExport: Prepare exportable data for this update
deactivate SearchAPI

note over DrupalExport
  Acts as middleware between
  Drupal and Fusion Connector.
  Can be contributed or custom-built.
end note

WebhookHandler -> CustomConnector: Send webhook with node ID

activate CustomConnector
note right of CustomConnector
  Trigger includes updated entity ID.
  Requires export endpoint to support
  filtering (e.g., ?id or ?since=timestamp)
end note

CustomConnector -> DrupalExport: Request export with **?since=timestamp**
activate DrupalExport
DrupalExport --> CustomConnector: Return partial content
deactivate DrupalExport

CustomConnector -> IndexingPipeline: Start partial indexing job
deactivate CustomConnector

activate IndexingPipeline
IndexingPipeline -> FusionCollection: Ingest partial data
deactivate IndexingPipeline

note bottom
  âš ï¸ This flow supports *partial indexing* only if
  the Drupal export endpoint supports filtering
  via query parameters like `?since=timestamp` or `?id=...`.

  Lucidworks must ensure connector logic handles this properly.
end note

legend bottom
|= Component             |= Meaning |
| **Drupal Platform**    ||
| ğŸ“ Drupal UI           | Content form interface (e.g. Press Release) |
| ğŸ§  Webhook Handler     | Triggers when node is updated |
| ğŸ“¦ Drupal Search API   | Indexer (Contrib module) |
| ğŸ”„ Drupal JSON Export  | Acts as middleware endpoint |
| **Fusion Platform**    ||
| ğŸ’¡ Custom Connector    | Receives webhooks and starts ingestion |
| ğŸ“Š Fusion Indexing     | Lucidworks pipeline to transform & ingest |
| ğŸ“‚ Fusion Collection   | Final Lucidworks index target |
endlegend

@enduml